!function(e,t){for(var i in t)e[i]=t[i]}(window,webpackJsonp([30],{"./lms/static/completion/js/ViewedEvent.js":function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){function i(){var i=Date.now();n+t<i&&(n=i,e())}var n=0;return i}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"ElementViewing",function(){return a}),i.d(t,"ViewedEventTracker",function(){return r});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,s){n(this,e),this.el=t,this.viewedAfterMs=i,this.callback=s,this.topSeen=!1,this.bottomSeen=!1,this.seenForMs=0,this.becameVisibleAt=void 0,this.hasBeenViewed=!1}return o(e,[{key:"getBoundingRect",value:function(){return this.el.getBoundingClientRect()}},{key:"handleVisible",value:function(){var e=this;this.becameVisibleAt||(this.becameVisibleAt=Date.now(),setTimeout(function(){e.checkIfViewed()},this.viewedAfterMs-this.seenForMs))}},{key:"handleNotVisible",value:function(){this.becameVisibleAt&&(this.seenForMs=Date.now()-this.becameVisibleAt),this.becameVisibleAt=void 0}},{key:"markTopSeen",value:function(){this.topSeen=!0,this.checkIfViewed()}},{key:"markBottomSeen",value:function(){this.bottomSeen=!0,this.checkIfViewed()}},{key:"getTotalTimeSeen",value:function(){return this.becameVisibleAt?this.seenForMs+(Date.now()-this.becameVisibleAt):this.seenForMs}},{key:"areViewedCriteriaMet",value:function(){return this.topSeen&&this.bottomSeen&&this.getTotalTimeSeen()>=this.viewedAfterMs}},{key:"checkIfViewed",value:function(){this.hasBeenViewed||this.areViewedCriteriaMet()&&(this.hasBeenViewed=!0,this.callback(this.el,{elementHasBeenViewed:this.hasBeenViewed}))}}]),e}(),r=function(){function e(t,i){var s=this;n(this,e),this.viewedAfterMs=i,this.elementViewings=new Set,this.handlers=[],this.interval=void 0,t.forEach(function(e){s.elementViewings.add(new a(e,i,function(e,t){return s.callHandlers(e,t)}))}),this.registerDomHandlers()}return o(e,[{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"updateVisible",value:function(){this.elementViewings.forEach(function(e){if(!e.hasBeenViewed){var t=Date.now(),i=e.getBoundingRect(),n=!1;i.top>0&&i.top<window.innerHeight&&(e.markTopSeen(t),n=!0),i.bottom>0&&i.bottom<window.innerHeight&&(e.markBottomSeen(t),n=!0),i.top<0&&i.bottom>window.innerHeight&&(n=!0),n?e.handleVisible(t):e.handleNotVisible(t)}})}},{key:"registerDomHandlers",value:function(){var e=this;window.onscroll=s(function(){return e.updateVisible()},100),window.onresize=s(function(){return e.updateVisible()},100),this.updateVisible()}},{key:"callHandlers",value:function(e,t){this.handlers.forEach(function(i){i(e,t)})}}]),e}()}},["./lms/static/completion/js/ViewedEvent.js"]));